<extraction><id>#34</id><title>Geotracking Events (enter/leave) don't fire after migrating mqtt base topic from mqttitude/ to owntracks/</title><description> On 0.4.16 Android (nexus 4 4.4.2) after migrating pub/sub topic to the new base topic
Enter/Leave Events are not firing correctly. By modifying a shared waypoint the message is published correctly to the topic.node-red flow to help testing the issue:[{"id":"935915de.8aaf08","type":"mqtt-broker","broker":"10.0.1.10","port":"1883"},{"id":"3e2f6060.7495a","type":"mqtt in","name":"owntracks geofence","topic":"owntracks/+/+/waypoints","broker":"935915de.8aaf08","x":158,"y":153,"z":"b4348802.41dcf","wires":[["2c9a5ef1.d3c942","a39036aa.cafa18"]]},{"id":"2c9a5ef1.d3c942","type":"debug","name":"","active":true,"complete":false,"x":503,"y":153,"z":"b4348802.41dcf","wires":[]},{"id":"46e9a84c.1ae098","type":"pushover","name":"","title":"Node-Red Message","message":"","priority":"-1","x":504,"y":277,"z":"b4348802.41dcf","wires":[]},{"id":"a39036aa.cafa18","type":"function","name":"","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\nvar now = Date();\ndata = JSON.parse(msg.payload);\n\nmessage = \"Event: \" + data.event + \" Location: \" + data.desc\n\n\nmsg.payload = message;\n\nreturn msg;","outputs":1,"x":359,"y":277,"z":"b4348802.41dcf","wires":[["46e9a84c.1ae098"]]}]</description><comments>If I'm deciphering the flow above correctly, you're subscribing to "topic": "owntracks/+/+/waypoints" which will catch published waypoints, but not enter/leave events.Those are published to owntracks/username/device with a _type=location as described in JSON and in Waypoints. BTW, as you probably know, the best way to debug this kind of thing (at least I find so) is to use a utility such as mosquitto_sub against your broker:Hope that helps. Yes "owntracks/+/+/waypoints" is the topic that i'm subscribing to in node-red.https://github.com/owntracks/owntracks/wiki/Waypoints may need a clarification in this part:"If you set up a shared waypoint, the app publishes that waypoint (without the retain flag, irrespective of your general preference) to the base topic with /waypoints tacked onto the topic (e.g. owntracks///waypoints) with the payload for _type=waypoint "that led me to subscribe the topic "owntracks/+/+/waypoints" that as I said gets the messages when I try to modify a shared waypoint and save. Ok, I've added a sentence to that para:But note that entering or leaving a waypoint will be published as a location message as described above. Ok so it was my fault, sorry. I've enabled Ticker on waypoint Notification and got a "Leaving/Entering $WORK" ticker upon leaving and reentering said waypoint. Glad it works, @juzam </comments></extraction>