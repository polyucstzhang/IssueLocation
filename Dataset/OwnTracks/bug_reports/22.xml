<extraction><id>#22</id><title>[CLOSED] [iOS] Connection dies if no subscription value in settings</title><description> Issue by sumnerboy12 from Monday Jan 13, 2014 at 05:56 GMT
Originally opened as binarybucks/mqttitude#263I cleared the subscription config on my wife's iPhone since I only want Mqttitude to send enter/leave events and don't care about any other messages (also set to manual mode).However once I did this all I saw on my broker were LWT messages from her phone. The connection details were ok, since the LWT publishes were coming through, but any time I entered or left a region or tried to manually publish I just got a LWT.When attempting a manual publish the connection status icon flashed yellow and then went red. Checking the status page showed a 'NSOSStatusErrorDomain -9806' error.I tried all sorts of different things and was about to log the bug, when I remembered removing the subscription settings. I added it back and voila - everything started working again!So it seems with an empty subscription value, the app fails to send any location publishes, even though it can connect ok.This is only on iOS, my Android phone seems fine with an empty subscription value.</description><comments>Comment by jpmens from Monday Jan 13, 2014 at 07:23 GMTmy Android phone seems fine with an empty subscription value.If you feel like starting your MQTT broker in debug mode, I think you'll see Android subscribes with a default of mqttitude/+/+ (the broker's debug log will show what the client is subscribing with). Comment by jpmens from Monday Jan 13, 2014 at 07:25 GMTIf you want to work around the issue for the moment, you could set your wife's phone to subscribe to a topic branch you won't be using (e.g.  "nothing/dear"); that way the phone won't be "pestered" :-) Comment by sumnerboy12 from Monday Jan 13, 2014 at 07:26 GMTYep - noticed this just before actually - the field is empty but in light grey it shows mqttitude/+/+ - and I noticed my wife's location popping up. So yes, I can confirm the Android app still subscribes. Comment by sumnerboy12 from Monday Jan 13, 2014 at 07:27 GMTYeah it is not a big issue for me - I am happy to have a subscription in there - but it took me a good hour of debugging to figure out what was going wrong so I figured it was worth noting here so Chris can have a look. Might cause others some headaches otherwise. Comment by jpmens from Monday Jan 13, 2014 at 07:28 GMTYes, and that is good! We wanted it thusly. I think your use-case is rather special. :-) Comment by sumnerboy12 from Monday Jan 13, 2014 at 07:32 GMTYep - happy with that, since I will disable auto-publishing on both apps once the geofence stuff is finished for Android. Comment by ckrey from Monday Jan 13, 2014 at 08:42 GMTGood you found that one!
I never thought of switching the subscription off...The app tries to subscribe with a zero length Topic Filter and the server correctly reacts by closing the connection.With 5.6, I will suppress the subscription if the the topic filter is specified as empty (zero length). Comment by sumnerboy12 from Monday Jan 13, 2014 at 08:55 GMTHappy to help!</comments></extraction>